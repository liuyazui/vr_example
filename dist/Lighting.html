<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>光源</title>
    <link type="text/css" rel="stylesheet" href="files/main.css">
</head>

<body>
    <script type="module">

        import * as THREE from './three/three.module.js';

        import { OBJLoader } from './jsm/loaders/OBJLoader.js';
        import { VTKLoader } from './jsm/loaders/VTKLoader.js';
        import { OrbitControls } from './jsm/controls/OrbitControls.js';

        let camera, scene, renderer,
            pointLight, spotLight, directLight, light4,
            object, spotObject;
        init();
        render();

        function init() {
            renderer = new THREE.WebGLRenderer({ antialias: true });
            camera = new THREE.PerspectiveCamera(50, window.innerWidth / window.innerHeight, 1, 1000);
            camera.position.set(0, 100, 200);
            scene = new THREE.Scene();
            scene.background = new THREE.Color(0xf0f0f0);

            //middle object
            const loader = new VTKLoader();
            loader.load("models/vtk/bunny.vtk", function (geometry) {

                geometry.center();
                geometry.computeVertexNormals();

                const material = new THREE.MeshLambertMaterial({ color: 0xffffff });
                const mesh = new THREE.Mesh(geometry, material);
                mesh.position.set(0, 0, 0);
                mesh.scale.multiplyScalar(200);
                scene.add(mesh);

            });

            const sphere = new THREE.SphereGeometry(0.5, 16, 8);
            //point light
            pointLight = new THREE.PointLight(0xff0000, 10, 50);
            pointLight.position.set(0, 20, 0);
            pointLight.add(new THREE.Mesh(sphere, new THREE.MeshBasicMaterial({ color: 0xff0000 })));
            scene.add(pointLight);

            const pointLightHelper = new THREE.PointLightHelper(pointLight, 5);
            scene.add(pointLightHelper);

            //right object
            loader.load("models/vtk/bunny.vtk", function (geometry) {

                geometry.center();
                geometry.computeVertexNormals();

                const material = new THREE.MeshLambertMaterial({ color: 0xffffff });
                const mesh = new THREE.Mesh(geometry, material);
                mesh.position.set(100, 0, 0);
                mesh.scale.multiplyScalar(200);
                scene.add(mesh);

            });

            //spot light
            spotLight = new THREE.SpotLight(0x00ff00, 1);
            spotLight.position.set(100, 40, 0);
            spotLight.angle = Math.PI / 4;
            spotLight.penumbra = 0.1;
            spotLight.decay = 2;
            spotLight.distance = 200;
            spotLight.castShadow = true;
            spotLight.shadow.mapSize.width = 512;
            spotLight.shadow.mapSize.height = 512;
            spotLight.target.position.set(100, 0, 0);
            spotLight.target.updateMatrixWorld();

            scene.add(spotLight);
            const spotLightHelper = new THREE.SpotLightHelper(spotLight);
            scene.add(spotLightHelper);

            //left object
            loader.load("models/vtk/bunny.vtk", function (geometry) {

                geometry.center();
                geometry.computeVertexNormals();

                const material = new THREE.MeshLambertMaterial({ color: 0xffffff });
                const mesh = new THREE.Mesh(geometry, material);
                mesh.position.set(-100, 0, 0);
                mesh.scale.multiplyScalar(200);
                scene.add(mesh);

            });

            directLight = new THREE.DirectionalLight(0x0000ff, 0.4);
            directLight.position.set(-100, 40, 0);
            directLight.castShadow = true;
            directLight.shadow.mapSize.width = 512;
            directLight.shadow.mapSize.height = 512;
            directLight.target.position.set(-100, 0, 0);
            directLight.target.updateMatrixWorld();

            scene.add(directLight);



            //地面网格
            let material = new THREE.MeshPhongMaterial({ color: 0x808080, dithering: true });
            let geometry = new THREE.PlaneGeometry(2000, 2000);
            let mesh = new THREE.Mesh(geometry, material);
            mesh.position.set(0, -20, 0);
            mesh.rotation.x = - Math.PI * 0.5;
            mesh.receiveShadow = true;
            scene.add(mesh);

            // 场景控制器
            const leftControl = new OrbitControls(camera, renderer.domElement);
            leftControl.addEventListener('change', render);

            //renderer
            renderer.setPixelRatio(window.devicePixelRatio);
            renderer.setSize(window.innerWidth, window.innerHeight);
            document.body.appendChild(renderer.domElement);

            window.addEventListener('resize', onWindowResize);

        }

        function onWindowResize() {

            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();

            renderer.setSize(window.innerWidth, window.innerHeight);

            render();
        }

        function render() {

            requestAnimationFrame(render);
            renderer.render(scene, camera);

        }

    </script>
</body>

</html>